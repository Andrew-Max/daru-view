#!/usr/bin/env ruby

require 'optparse'
require 'rake'

Dir.chdir File.expand_path('..',__dir__)

parser = OptionParser.new do |opts|
  opts.banner = "Usage: daru-view [options]"
  # TODO add arguments to update only modules/adapters/a particular file

  # Update google charts javascript dependent files, from latest Builds
  # on the google developers website
  opts.on('-g', '--update-googlecharts', 'Update googlecharts.js libraries') do
    update(:googlecharts)
  end

  # Update highcharts.js from latest Builds on Highcharts codebase
  # http://code.highcharts.com/
  opts.on('-H', '--update-highcharts', 'Update highcharts.js libraries') do
    update(:highcharts)
  end

  opts.on('-h', '--help', 'Displays Help') do
    puts opts
    exit
  end
end

def update(type)
  path = File.expand_path('../lib/tasks',__dir__)
  app  = Rake.application
  app.init
  case type
  when :googlecharts
    app.rake_require 'google_charts', paths = [path]
    app['googlecharts:update'].invoke
  when :highcharts
    app.rake_require 'high_charts', paths = [path]
    app['highcharts:update'].invoke
  end
end

parser.parse!
